<div class='title_row first'>
    <h3><?php $this->_('CWatch.tab_malware.add_scanner');?></h3>
</div>
<div class="row">
    <div class="col-md-12">
        <h4><?php $this->_('CWatch.tab_malware.add_new_site');?></h4>
        <?php
        $this->Form->create($this->base_uri . 'services/manage/' . $this->Html->ifSet($service->id) . '/tabClientMalware/', ['id' => 'malware']);
        $this->Form->fieldHidden('actionname', 'addscanner');
        ?>
        <div class="form-group">
            <?php
            $this->Form->label($this->_('CWatch.tab_malware.domainname', true), 'domainname');
            $this->Form->fieldSelect('domainname', $this->Html->ifSet($sites), $this->Html->ifSet($vars['domainname']), ['class' => 'form-control', 'id' => 'domainname']);
            ?>
        </div>
        <div class="form-group">
            <?php
            $this->Form->label($this->_('CWatch.tab_malware.ftpusername', true), 'ftpusername');
            $this->Form->fieldText('username', $this->Html->ifSet($vars['username']), ['class' => 'form-control', 'id' => 'ftpusername']);
            ?>
        </div>
        <div class="form-group">
            <?php
            $this->Form->label($this->_('CWatch.tab_malware.ftppassword', true), 'ftppassword');
            $this->Form->fieldPassword('password', ['class' => 'form-control', 'id' => 'ftppassword']);
            ?>
        </div>
        <div class="form-group">
            <?php
            $this->Form->label($this->_('CWatch.tab_malware.host', true), 'host');
            $this->Form->fieldText('host', $this->Html->ifSet($vars['host']), ['class' => 'form-control', 'id' => 'host']);
            ?>
        </div>
        <div class="form-group">
            <?php
            $this->Form->label($this->_('CWatch.tab_malware.port', true), 'port');
            $this->Form->fieldText('port', $this->Html->ifSet($vars['port']), ['class' => 'form-control', 'id' => 'port']);
            ?>
        </div>
        <div class="form-group">
            <?php
            $this->Form->label($this->_('CWatch.tab_malware.path', true), 'path');
            $this->Form->fieldText('path', $this->Html->ifSet($vars['path']), ['class' => 'form-control', 'id' => 'path']);
            ?>
        </div>
        <div class="form-group">
            <?php
            $this->Form->label($this->_('CWatch.tab_malware.sftp', true), 'sftp');
            $this->Form->fieldCheckbox('sftp', 'true', $this->Html->ifSet($vars['sftp']) == 'true', ['id' => 'sftp']);
            ?>
        </div>
        <button class="btn btn-default pull-right">
            <i class="fa fa-edit"></i> <?php $this->_('CWatch.tab_malware.submit');?>
        </button>
        <?php
        $this->Form->fieldSubmit('test_ftp', $this->_('CWatch.tab_malware.test_credentials', true), ['class' => 'test_ftp btn btn-warning pull-right']);
        $this->Form->end();
        ?>
    </div>
    <div class="hide">
        <?php
        foreach ($this->Html->ifSet($domains_ftp, []) as $domain => $domain_ftp) {
        ?>
        <div data-domain="<?php echo $domain;?>" data-login="<?php echo $this->Html->ifSet($domain_ftp->login);?>" data-host="<?php echo $this->Html->ifSet($domain_ftp->host);?>" data-port="<?php echo $this->Html->ifSet($domain_ftp->port);?>" data-path="<?php echo $this->Html->ifSet($domain_ftp->path);?>"></div>
        <?php
        }
        ?>
    </div>
</div>
<script>
$(document).on('ready', function() {
    $('#domainname').on('change', function() {
        var ftp = $('div[data-domain="' + $(this).val() + '"]');
        $('#ftpusername').val(ftp.data('login'));
        $('#host').val(ftp.data('host'));
        $('#port').val(ftp.data('port'));
        $('#path').val(ftp.data('path'));
    });
});
</script>