<div class='title_row first'>
    <h3><?php $this->_('CWatch.tab_malware.add_scanner');?></h3>
</div>
<div class="row">
    <div class="col-md-12">
        <?php
        $this->Form->create($this->base_uri . 'clients/serviceTab/' . $this->Html->ifSet($service->client_id) . '/' . $this->Html->ifSet($service->id) . '/tabMalware/', ['id' => 'malware', 'class' => 'disable-on-submit']);
        $this->Form->fieldHidden('actionname', 'addscanner');
        ?>
        <ul>
            <li>
                <?php
                $this->Form->label($this->_('CWatch.tab_malware.domainname', true), 'domainname');
                $this->Form->fieldSelect('domainname', $this->Html->ifSet($sites), $this->Html->ifSet($vars['domainname']), ['id' => 'domainname']);
                ?>
            </li>
            <li>
                <?php
                $this->Form->label($this->_('CWatch.tab_malware.ftpusername', true), 'ftpusername');
                $this->Form->fieldText('username', $this->Html->ifSet($vars['username']), ['class' => 'form-control','id' => 'ftpusername']);
                ?>
            </li>
            <li>
                <?php
                $this->Form->label($this->_('CWatch.tab_malware.ftppassword', true), 'ftppassword');
                $this->Form->fieldPassword('password', ['class' => 'form-control','id' => 'ftppassword', 'value' => $this->Html->ifSet($vars['password'])]);
                ?>
            </li>
            <li>
                <?php
                $this->Form->label($this->_('CWatch.tab_malware.host', true), 'host');
                $this->Form->fieldText('host', $this->Html->ifSet($vars['host']), ['class' => 'form-control','id' => 'host']);
                ?>
            </li>
            <li>
                <?php
                $this->Form->label($this->_('CWatch.tab_malware.port', true), 'port');
                $this->Form->fieldText('port', $this->Html->ifSet($vars['port']), ['class' => 'form-control','id' => 'port']);
                ?>
            </li>
            <li>
                <?php
                $this->Form->fieldCheckbox('sftp', 'true', $this->Html->ifSet($vars['sftp']) == 'true', ['class' => 'form-control', 'id' => 'sftp']);
                $this->Form->label($this->_('CWatch.tab_malware.sftp', true), 'sftp', ['class' => 'inline']);
                ?>
            </li>
            <li>
                <?php
                $this->Form->label($this->_('CWatch.tab_malware.path', true), 'path');
                $this->Form->fieldText('path', $this->Html->ifSet($vars['path']), ['class' => 'form-control','id' => 'path']);
                ?>
            </li>
        </ul>
        <button class="btn btn-default">
            <i class="fa fa-edit"></i> <?php $this->_('CWatch.tab_malware.submit');?>
        </button>
        <?php
        $this->Form->fieldSubmit('test_ftp', $this->_('CWatch.tab_malware.test_credentials', true), ['class' => 'test_ftp btn btn-warning']);
        $this->Form->end();
        ?>
    </div>
    <div class="hide">
        <?php
        foreach ($this->Html->ifSet($domains_ftp, []) as $domain => $domain_ftp) {
        ?>
        <div data-domain="<?php echo $domain;?>" data-login="<?php echo $this->Html->ifSet($domain_ftp->login);?>" data-host="<?php echo $this->Html->ifSet($domain_ftp->host);?>" data-port="<?php echo $this->Html->ifSet($domain_ftp->port);?>" data-path="<?php echo $this->Html->ifSet($domain_ftp->path);?>"></div>
        <?php
        }
        ?>
    </div>
</div>
<script>
$(document).on('ready', function() {
    $('#domainname').change(function() {
        var ftp = $('div[data-domain="' + $(this).val() + '"]');
        $('#ftpusername').val(ftp.data('login'));
        $('#host').val(ftp.data('host'));
        $('#port').val(ftp.data('port'));
        $('#path').val(ftp.data('path'));
    });
});
</script>
